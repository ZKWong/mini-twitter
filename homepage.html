<!DOCTYPE html >
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<script src='vue2516.js'></script>
		<link rel="stylesheet"  type = "text/css" href="homepage.css" /> 
		<title>Mini-Twitter Homepage </title>
	</head>
	<body>
		<div id="header">
			<div id="name">Mini Twitter Home</div>
			<button v-on:click='logout()' id = "logout">Logout</button>
		</div>

		<div id="sidebar-left">
			<div id="profile">
				<div id = "profileHeader">Profile</div>
				Welcome $username
			</div>
			
			<div id="following">
				$following
			</div>
		
		</div>

		<div id="content">
			<textarea v-model = 'writepost' cols = '135' placeholder = "What is on your mind?"></textarea>
			<button v-on:click='tweet()' id = "tweet">Tweet</button>
			<textarea v-model = 'displaypost' rows = '35' cols = '135' id=displaypost></textarea>
		</div>
		
		
		<div id="footer">
			
		</div>
	</body>
</html>

<script>
	var usrname = '$username'
	
	var content = new Vue({
		el: '#content',
		data: {
			writepost: '',
			displaypost: '$content',
		},
		methods: {
			tweet: function(){
				if (this.writepost == "") {
					alert("write post must not be empty")
					return false
				}
				var curdate = new Date();
				var timestr = curdate.getFullYear() + '-'; //+ curdate.getMonth() + '-' + curdate.getDate() + ' ' + curdate.getHours() + ':' +  curdate.getMinutes()+ ':' + curdate.getSeconds();
				timestr = timestr + (((curdate.getMonth())+1 < 10) ? '0' + ((curdate.getMonth())+1) : (curdate.getMonth())+1) + '-';
				timestr = timestr + (((curdate.getDate())< 10) ? '0' + ((curdate.getDate())) : (curdate.getDate())) + ' ';
				timestr = timestr + (((curdate.getHours())< 10) ? '0' + ((curdate.getHours())) : (curdate.getHours())) + ':';
				timestr = timestr + (((curdate.getMinutes())< 10) ? '0' + ((curdate.getMinutes())) : (curdate.getMinutes())) + ':';
				timestr = timestr + (((curdate.getSeconds())< 10) ? '0' + ((curdate.getSeconds())) : (curdate.getSeconds()));
				this.displaypost = this.displaypost + '[' + timestr + '] ' + this.writepost + "\n"
				var xhr = new XMLHttpRequest();
					xhr.onreadystatechange = function () {
					if (xhr.readyState == 4 && xhr.status == 200) {
						var postresult = xhr.responseText;
					}
				}
				xhr.open('GET', 'postmessage?username=' + usrname + '&msg=' + this.writepost);
				xhr.send(null);
			}
		}

	})	

	var header = new Vue({
   el: '#header',
   methods: {
     logout: function(){
       logout();     }
   }
 	})

	var following = new Vue({
   el: '#following',
   methods: {
     follow: function(username){
					var xhr = new XMLHttpRequest();
					xhr.onreadystatechange = function () {
					if (xhr.readyState == 4 && xhr.status == 200) {
						var followmsg = xhr.responseText;
						content.displaypost = followmsg;
					}
				}
				xhr.open('GET', 'get_followmsg?username=' + username);
				xhr.send(null);      
		}
   }
 	})
	function logout(){
		document.location.replace("/");
	}
	
</script>
